# –ü–ª–∞–Ω —É–ø—Ä–æ—â–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏

**–î–∞—Ç–∞:** 2025-01-31  
**–¶–µ–ª—å:** –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ - –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `user_id` –∫–∞–∫ –æ—Å–Ω–æ–≤—É, `company_ids` –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä

---

## üìã –û–±—â–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:
1. **–ë–∞–∑–æ–≤–∞—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** = –≤—Å–µ–≥–¥–∞ —á–µ—Ä–µ–∑ `user_id` (–≤—Å–µ –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
2. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** = —á–µ—Ä–µ–∑ `company_ids` (–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ: —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∫–æ–º–ø–∞–Ω–∏–∏ –∏–∑ —Å–ø–∏—Å–∫–∞)

### –õ–æ–≥–∏–∫–∞:
```python
if current_user:
    # –í—Å–µ–≥–¥–∞ —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø–æ user_id (–±–∞–∑–æ–≤–∞—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è)
    user_companies = get_user_company_ids(user)
    
    if company_ids:
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è: –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ
        final_companies = user_companies ‚à© company_ids
    else:
        # –í—Å–µ –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        final_companies = user_companies
else:
    # –ê–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - —Ç–æ–ª—å–∫–æ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏
    final_companies = global_companies
```

---

## ‚úÖ TODO List

### 1. –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ª–æ–≥–∏–∫—É –≤ `GET /news/` (get_news)
**–§–∞–π–ª:** `backend/app/api/v1/endpoints/news.py` (—Å—Ç—Ä–æ–∫–∏ 255-394)

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
- –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –º–µ–∂–¥—É `user_id` –∏ `company_ids` (—Å—Ç—Ä–æ–∫–∏ 329-381)
- –ú–Ω–æ–≥–æ —É—Å–ª–æ–≤–∏–π –∏ –≤–µ—Ç–≤–ª–µ–Ω–∏–π

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
- –£–±—Ä–∞—Ç—å —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É `use_user_id_filter`
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `user_id` –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω `company_ids` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä (–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ)
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å –∫–æ–¥ –¥–æ 20-30 —Å—Ç—Ä–æ–∫ –≤–º–µ—Å—Ç–æ 50+

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```python
# –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞
if current_user:
    final_user_id = str(current_user.id)
    # –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω company_ids - –±—É–¥–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
    final_company_ids = [str(cid) for cid in filter_company_ids] if filter_company_ids else None
else:
    final_user_id = None
    final_company_ids = None
```

---

### 2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å `GET /news/search` (search_news)
**–§–∞–π–ª:** `backend/app/api/v1/endpoints/news.py` (—Å—Ç—Ä–æ–∫–∏ 601-700)

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –ø–∞–º—è—Ç–∏ –ø–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞ (—Å—Ç—Ä–æ–∫–∏ 682-689)
- –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
- –£–±—Ä–∞—Ç—å `facade.search_news()` –∏ in-memory —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `facade.list_news()` —Å `user_id` –∏ `search_query`
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ SQL —á–µ—Ä–µ–∑ `list_news_by_user_id`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```python
# –ò—Å–ø–æ–ª—å–∑—É–µ–º list_news —Å search_query –∏ user_id
news_items, total_count = await facade.list_news(
    user_id=final_user_id,
    search_query=q,
    category=category,
    source_type=source_type,
    limit=limit,
    offset=offset
)
```

---

### 3. –£–ø—Ä–æ—Å—Ç–∏—Ç—å `GET /news/category/{category}` (get_category_news)
**–§–∞–π–ª:** `backend/app/api/v1/endpoints/news.py` (—Å—Ç—Ä–æ–∫–∏ 821-947)

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫–∞–∫ –≤ `get_news`

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–µ –∂–µ —É–ø—Ä–æ—â–µ–Ω–∏—è —á—Ç–æ –∏ –≤ `get_news`
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `user_id` –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
- `company_ids` –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä

---

### 4. –û–±–Ω–æ–≤–∏—Ç—å `PersonalizationService.get_filter_company_ids`
**–§–∞–π–ª:** `backend/app/core/personalization.py` (—Å—Ç—Ä–æ–∫–∏ 29-92)

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–¥–∞–µ—Ç `company_ids`, –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É: `company_ids` –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ: `user_companies ‚à© provided_ids`
- –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å–º–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å —á—É–∂–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```python
if provided_ids is not None:
    # –ü–æ–ª—É—á–∞–µ–º –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user_company_ids = await get_user_company_ids(user, self._db)
    # –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ: —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∫–æ–º–ø–∞–Ω–∏–∏ –∏–∑ —Å–ø–∏—Å–∫–∞
    valid_ids = [cid for cid in provided_ids if cid in user_company_ids]
    return valid_ids if valid_ids else []
```

---

### 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `list_news_by_user_id` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
**–§–∞–π–ª:** `backend/app/domains/news/repositories/news_repository.py` (—Å—Ç—Ä–æ–∫–∏ 193-300)

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è `company_ids` –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä
- –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω `user_id` –∏ `company_ids`, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ

**–í–æ–∑–º–æ–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ï—Å–ª–∏ –≤ `filters` –µ—Å—Ç—å `company_ids` –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `user_id`, –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
- –ò–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ API)

---

### 6. –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
**–§–∞–π–ª—ã:** `backend/app/api/v1/endpoints/news.py`

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–µ –ª–æ–≥–∏:
  - "Using user_id filter for personalization"
  - "Using user_id + company_ids filter (intersection)"
  - "Anonymous user - showing global companies only"

**–¶–µ–ª—å:** –£–ø—Ä–æ—Å—Ç–∏—Ç—å –æ—Ç–ª–∞–¥–∫—É –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

---

### 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

**–°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**

1. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ company_ids**
   - –î–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å –Ω–æ–≤–æ—Å—Ç–∏ –≤—Å–µ—Ö —Å–≤–æ–∏—Ö –∫–æ–º–ø–∞–Ω–∏–π
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `GET /news/` —Å —Ç–æ–∫–µ–Ω–æ–º

2. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å company_ids**
   - –î–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å –Ω–æ–≤–æ—Å—Ç–∏ —Ç–æ–ª—å–∫–æ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π (–∏–∑ —Å–≤–æ–∏—Ö)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `GET /news/?company_ids=uuid1,uuid2`

3. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —á—É–∂–∏–º–∏ company_ids**
   - –ù–µ –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å –Ω–æ–≤–æ—Å—Ç–∏ —á—É–∂–∏—Ö –∫–æ–º–ø–∞–Ω–∏–π
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `GET /news/?company_ids=other_user_company_uuid`
   - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –∏–ª–∏ —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∫–æ–º–ø–∞–Ω–∏–∏

4. **–ê–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**
   - –î–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `GET /news/` –±–µ–∑ —Ç–æ–∫–µ–Ω–∞

5. **–ü–æ–∏—Å–∫ —Å user_id**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `GET /news/search?q=test` —Å —Ç–æ–∫–µ–Ω–æ–º
   - –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å SQL-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, –Ω–µ in-memory

6. **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å user_id**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `GET /news/category/product_update` —Å —Ç–æ–∫–µ–Ω–æ–º
   - –î–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è

---

### 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

1. **AuthNewsPage**
   - –í—ã–±–æ—Ä –∫–æ–º–ø–∞–Ω–∏–π –≤ —Ñ–∏–ª—å—Ç—Ä–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –ù–æ–≤–æ—Å—Ç–∏ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∫–æ–º–ø–∞–Ω–∏—è–º

2. **DashboardPage**
   - –§–∏–ª—å—Ç—Ä "—Ç–æ–ª—å–∫–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ" —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –í—ã–±–æ—Ä –∫–æ–º–ø–∞–Ω–∏–π –≤ —Ñ–∏–ª—å—Ç—Ä–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

3. **CategoryDetailPage**
   - –§–∏–ª—å—Ç—Ä "—Ç–æ–ª—å–∫–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ" —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

4. **–û–±—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**
   - –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
   - –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   - –ù–µ—Ç –ª–∏—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API

---

## üîç –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `get_news`:

**–ë—ã–ª–æ (—Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞):**
```python
use_user_id_filter = (
    current_user is not None 
    and parsed_company_ids is None
    and filter_company_ids is not None
)

if use_user_id_filter:
    final_user_id = str(current_user.id)
elif filter_company_ids is None:
    # ... –º–Ω–æ–≥–æ —É—Å–ª–æ–≤–∏–π
elif not filter_company_ids:
    # ...
else:
    # ... –µ—â–µ –±–æ–ª—å—à–µ —É—Å–ª–æ–≤–∏–π
```

**–°—Ç–∞–Ω–µ—Ç (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞):**
```python
# –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º user_id –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
if current_user:
    final_user_id = str(current_user.id)
    
    # –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω company_ids - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
    if filter_company_ids:
        final_company_ids = [str(cid) for cid in filter_company_ids]
    else:
        final_company_ids = None
else:
    # –ê–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    final_user_id = None
    final_company_ids = None
```

---

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `search_news`:

**–ë—ã–ª–æ (in-memory —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è):**
```python
news_items, total_count = await facade.search_news(search_params)

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤ –ø–∞–º—è—Ç–∏
if filter_company_ids:
    filtered_items = [
        item for item in news_items
        if item.company_id in filter_company_ids
    ]
    news_items = filtered_items
```

**–°—Ç–∞–Ω–µ—Ç (SQL-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è):**
```python
# –ò—Å–ø–æ–ª—å–∑—É–µ–º list_news —Å search_query –∏ user_id
news_items, total_count = await facade.list_news(
    user_id=final_user_id,
    search_query=q,
    category=category,
    source_type=source_type,
    limit=limit,
    offset=offset
)
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ `company_ids` –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   - –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ: `user_companies ‚à© provided_ids`

2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JOIN —á–µ—Ä–µ–∑ `user_id` (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)
   - –ò–∑–±–µ–≥–∞—Ç—å in-memory —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤

3. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
   - API –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Å—Ç–∞—é—Ç—Å—è —Ç–µ–º–∏ –∂–µ
   - –§—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - –ü–æ–≤–µ–¥–µ–Ω–∏–µ —É–ª—É—á—à–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è

4. **–ü—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
   - –ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –∫–æ–º–ø–∞–Ω–∏–π ‚Üí –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
   - –ï—Å–ª–∏ `company_ids` –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è —Å `user_companies` ‚Üí –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫

---

## üìä –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

- **–ó–∞–¥–∞—á–∞ 1** (get_news): ~20 –º–∏–Ω—É—Ç
- **–ó–∞–¥–∞—á–∞ 2** (search_news): ~15 –º–∏–Ω—É—Ç
- **–ó–∞–¥–∞—á–∞ 3** (get_category_news): ~15 –º–∏–Ω—É—Ç
- **–ó–∞–¥–∞—á–∞ 4** (PersonalizationService): ~15 –º–∏–Ω—É—Ç
- **–ó–∞–¥–∞—á–∞ 5** (—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π): ~10 –º–∏–Ω—É—Ç (–ø—Ä–æ–≤–µ—Ä–∫–∞)
- **–ó–∞–¥–∞—á–∞ 6** (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ): ~10 –º–∏–Ω—É—Ç
- **–ó–∞–¥–∞—á–∞ 7** (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ): ~30 –º–∏–Ω—É—Ç
- **–ó–∞–¥–∞—á–∞ 8** (—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥): ~20 –º–∏–Ω—É—Ç

**–ò—Ç–æ–≥–æ:** ~2 —á–∞—Å–∞

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

1. ‚úÖ –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `user_id` –∫–∞–∫ –æ—Å–Ω–æ–≤—É
2. ‚úÖ `company_ids` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä (–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ)
3. ‚úÖ `search_news` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SQL-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é, –Ω–µ in-memory
4. ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å —á—É–∂–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
5. ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
6. ‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
7. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–Ω—è—Ç–Ω–æ–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á:
1. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
2. –ü—Ä–æ–≤–µ—Å—Ç–∏ code review
3. –î–µ–ø–ª–æ–π –Ω–∞ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ä–µ–¥—É
4. –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
