# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏

**–î–∞—Ç–∞:** 2025-01-31  
**–í–µ—Ä—Å–∏—è:** 0.1.0  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## üìã –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ.

**–ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø:** –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ `user_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `companies`, –∞ –ù–ï –Ω–∞ `subscribed_companies`!

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–≠—Ç–∞–ø 1-3)
- –°–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ—Å—Ç–µ–π
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å–∞–º

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –£–ª—É—á—à–µ–Ω–∏–µ UX (–≠—Ç–∞–ø 4)
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ "–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ"
- –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –ø—É—Å—Ç—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–≠—Ç–∞–ø 5)
- –¢–µ—Å—Ç—ã –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –¢–µ—Å—Ç—ã –∑–∞—â–∏—Ç—ã –æ—Ç –ø–æ–¥–º–µ–Ω—ã ID

---

## –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞

### –ó–∞–¥–∞—á–∞ 1.1: –°–æ–∑–¥–∞—Ç—å `backend/app/core/access_control.py`

**–§–∞–π–ª:** `backend/app/core/access_control.py` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
```python
"""
Centralized access control functions for personalization.

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ user_id –∫–æ–º–ø–∞–Ω–∏–π, 
–∞ –ù–ï –Ω–∞ subscribed_companies!
"""

from typing import Optional
from uuid import UUID
from fastapi import HTTPException
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, and_, or_

from app.models import User, Company, NewsItem


async def check_company_access(
    company_id: UUID | str,
    user: Optional[User],
    db: AsyncSession
) -> Optional[Company]:
    """
    Check if user has access to company and return it.
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –ø–æ user_id –∫–æ–º–ø–∞–Ω–∏–∏ (–ù–ï –ø–æ subscribed_companies!).
    
    Args:
        company_id: Company UUID or string
        user: Current user (None for anonymous)
        db: Database session
        
    Returns:
        Company if accessible, None otherwise
    """
    if isinstance(company_id, str):
        try:
            company_id = UUID(company_id)
        except ValueError:
            return None
    
    query = select(Company).where(Company.id == company_id)
    
    if user:
        query = query.where(
            or_(
                Company.user_id == user.id,
                Company.user_id.is_(None)  # Global companies
            )
        )
    else:
        query = query.where(Company.user_id.is_(None))
    
    result = await db.execute(query)
    return result.scalar_one_or_none()


async def check_news_access(
    news_id: UUID | str,
    user: Optional[User],
    db: AsyncSession
) -> Optional[NewsItem]:
    """
    Check if user has access to news item and return it.
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –ø–æ user_id –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–æ–≤–æ—Å—Ç–∏ (–ù–ï –ø–æ subscribed_companies!).
    
    Args:
        news_id: News UUID or string
        user: Current user (None for anonymous)
        db: Database session
        
    Returns:
        NewsItem if accessible, None otherwise
    """
    if isinstance(news_id, str):
        try:
            news_id = UUID(news_id)
        except ValueError:
            return None
    
    result = await db.execute(
        select(NewsItem).where(NewsItem.id == news_id)
    )
    news_item = result.scalar_one_or_none()
    
    if not news_item:
        return None
    
    # Check if company belongs to user (user_id = user.id)
    if user:
        company_result = await db.execute(
            select(Company).where(
                and_(
                    Company.id == news_item.company_id,
                    Company.user_id == user.id
                )
            )
        )
        company = company_result.scalar_one_or_none()
        if not company:
            return None
    
    return news_item


async def get_user_company_ids(
    user: User,
    db: AsyncSession
) -> list[UUID]:
    """
    Get all company IDs that belong to user.
    –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ ID –∫–æ–º–ø–∞–Ω–∏–π, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (user_id = user.id).
    
    Args:
        user: Current user
        db: Database session
        
    Returns:
        List of company UUIDs
    """
    result = await db.execute(
        select(Company.id).where(Company.user_id == user.id)
    )
    return [c.id for c in result.scalars().all()]
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –§–∞–π–ª —Å–æ–∑–¥–∞–Ω
- [ ] –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ò–º–ø–æ—Ä—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

---

## –≠—Ç–∞–ø 2: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ—Å—Ç–µ–π

### –ó–∞–¥–∞—á–∞ 2.1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å `GET /api/v1/news/`

**–§–∞–π–ª:** `backend/app/api/v1/endpoints/news.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

**–î–û:**
```python
# Automatic isolation: if user is authenticated and didn't specify company_ids,
# filter by subscribed_companies from UserPreferences
if current_user and not parsed_company_ids:
    try:
        prefs_result = await db.execute(
            select(UserPreferences).where(UserPreferences.user_id == current_user.id)
        )
        user_prefs = prefs_result.scalar_one_or_none()
        
        if user_prefs and user_prefs.subscribed_companies:
            # –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø–æ subscribed_companies
            parsed_company_ids = user_prefs.subscribed_companies
```

**–ü–û–°–õ–ï:**
```python
# Automatic isolation: if user is authenticated and didn't specify company_ids,
# filter by user_id companies (–ù–ï –ø–æ subscribed_companies!)
if current_user and not parsed_company_ids:
    try:
        from app.core.access_control import get_user_company_ids
        # –ü–†–ê–í–ò–õ–¨–ù–û: —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø–æ user_id –∫–æ–º–ø–∞–Ω–∏–π
        user_company_ids = await get_user_company_ids(current_user, db)
        if user_company_ids:
            parsed_company_ids = user_company_ids
            normalised_company_id = None  # Reset single company_id, use list instead
            logger.info(
                f"Auto-filtering news by {len(parsed_company_ids)} user companies "
                f"for user {current_user.id}"
            )
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ `user_id` –∫–æ–º–ø–∞–Ω–∏–π
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### –ó–∞–¥–∞—á–∞ 2.2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å `GET /api/v1/news/stats`

**–§–∞–π–ª:** `backend/app/api/v1/endpoints/news.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

**–î–û:**
```python
if user_prefs and user_prefs.subscribed_companies:
    # Filter statistics by subscribed companies
    stats = await facade.get_statistics_for_companies(
        [str(cid) for cid in user_prefs.subscribed_companies]
    )
```

**–ü–û–°–õ–ï:**
```python
from app.core.access_control import get_user_company_ids

user_company_ids = await get_user_company_ids(current_user, db)
if user_company_ids:
    # Filter statistics by user companies (user_id)
    stats = await facade.get_statistics_for_companies(
        [str(cid) for cid in user_company_ids]
    )
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è –ø–æ `user_id` –∫–æ–º–ø–∞–Ω–∏–π
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### –ó–∞–¥–∞—á–∞ 2.3: –ò—Å–ø—Ä–∞–≤–∏—Ç—å `GET /api/v1/news/stats/by-companies`

**–§–∞–π–ª:** `backend/app/api/v1/endpoints/news.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

**–î–û:**
```python
if user_prefs and user_prefs.subscribed_companies:
    subscribed_ids = set(user_prefs.subscribed_companies)
    if requested_ids and not requested_ids.issubset(subscribed_ids):
        raise HTTPException(status_code=403, detail="Access denied")
```

**–ü–û–°–õ–ï:**
```python
from app.core.access_control import check_company_access

# Validate that all requested companies belong to user (user_id)
for company_id in parsed_company_ids:
    company = await check_company_access(company_id, current_user, db)
    if not company:
        raise HTTPException(
            status_code=403,
            detail=f"Access denied to company {company_id}"
        )
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ `user_id`
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## –≠—Ç–∞–ø 3: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å–∞–º

### –ó–∞–¥–∞—á–∞ 3.1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å `GET /api/v1/news/{news_id}`

**–§–∞–π–ª:** `backend/app/api/v1/endpoints/news.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

**–î–û:**
```python
@router.get("/{news_id}")
async def get_news_item(
    news_id: str,
    facade: NewsFacade = Depends(get_news_facade),
):
    news_item = await facade.get_news_item(news_id, include_relations=True)
    # –ù–ï–¢ –ü–†–û–í–ï–†–ö–ò –î–û–°–¢–£–ü–ê
    return serialize_news_item(news_item, include_activities=True)
```

**–ü–û–°–õ–ï:**
```python
@router.get("/{news_id}")
async def get_news_item(
    news_id: str,
    current_user: User = Depends(get_current_user),
    facade: NewsFacade = Depends(get_news_facade),
    db: AsyncSession = Depends(get_db),
):
    from app.core.access_control import check_news_access
    
    news_item = await check_news_access(news_id, current_user, db)
    if not news_item:
        raise HTTPException(
            status_code=403,
            detail="Access denied"
        )
    
    return serialize_news_item(news_item, include_activities=True)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 403 –¥–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### –ó–∞–¥–∞—á–∞ 3.2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å `PUT /api/v1/news/{news_id}`

**–§–∞–π–ª:** `backend/app/api/v1/endpoints/news.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

**–î–û:**
```python
@router.put("/{news_id}")
async def update_news(
    news_id: str,
    payload: NewsUpdateSchema,
    facade: NewsFacade = Depends(get_news_facade),
):
    # –ù–ï–¢ –ü–†–û–í–ï–†–ö–ò –î–û–°–¢–£–ü–ê
    news_item = await facade.update_news(news_id, update_data)
```

**–ü–û–°–õ–ï:**
```python
@router.put("/{news_id}")
async def update_news(
    news_id: str,
    payload: NewsUpdateSchema,
    current_user: User = Depends(get_current_user),
    facade: NewsFacade = Depends(get_news_facade),
    db: AsyncSession = Depends(get_db),
):
    from app.core.access_control import check_news_access
    
    # –°–ù–ê–ß–ê–õ–ê –ü–†–û–í–ï–†–Ø–ï–ú –î–û–°–¢–£–ü
    news_item = await check_news_access(news_id, current_user, db)
    if not news_item:
        raise HTTPException(
            status_code=403,
            detail="Access denied"
        )
    
    # –¢–û–õ–¨–ö–û –ü–û–°–õ–ï –ü–†–û–í–ï–†–ö–ò –û–ë–ù–û–í–õ–Ø–ï–ú
    update_data = payload.model_dump(exclude_unset=True)
    news_item = await facade.update_news(news_id, update_data)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 403 –¥–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### –ó–∞–¥–∞—á–∞ 3.3: –ò—Å–ø—Ä–∞–≤–∏—Ç—å `DELETE /api/v1/news/{news_id}`

**–§–∞–π–ª:** `backend/app/api/v1/endpoints/news.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∑–∞–¥–∞—á–µ 3.2, –Ω–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 403 –¥–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### –ó–∞–¥–∞—á–∞ 3.4: –ò—Å–ø—Ä–∞–≤–∏—Ç—å `GET /api/v1/companies/{company_id}`

**–§–∞–π–ª:** `backend/app/api/v1/endpoints/companies.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

**–î–û:**
```python
# –°–ù–ê–ß–ê–õ–ê –ü–û–õ–£–ß–ê–ï–ú –ö–û–ú–ü–ê–ù–ò–Æ
result = await db.execute(
    select(Company).where(Company.id == uuid_obj)
)
company = result.scalar_one_or_none()

if not company:
    raise HTTPException(status_code=404, detail="Company not found")

# –ü–†–û–í–ï–†–ö–ê –î–û–°–¢–£–ü–ê –ü–û–°–õ–ï –ü–û–õ–£–ß–ï–ù–ò–Ø (—Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é!)
if company.user_id is not None:
    if not current_user or company.user_id != current_user.id:
        raise HTTPException(status_code=403, detail="Access denied")
```

**–ü–û–°–õ–ï:**
```python
from app.core.access_control import check_company_access

# –ü–†–û–í–ï–†–ö–ê –î–û–°–¢–£–ü–ê –í SQL –ó–ê–ü–†–û–°–ï (–±–µ–∑–æ–ø–∞—Å–Ω–æ!)
company = await check_company_access(company_id, current_user, db)

if not company:
    # –í—Å–µ–≥–¥–∞ 404, –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    raise HTTPException(status_code=404, detail="Company not found")
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ SQL –∑–∞–ø—Ä–æ—Å–µ
- [ ] –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404 –¥–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### –ó–∞–¥–∞—á–∞ 3.5: –ò—Å–ø—Ä–∞–≤–∏—Ç—å `POST /api/v1/competitors/compare`

**–§–∞–π–ª:** `backend/app/api/v1/endpoints/competitors.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

**–î–û:**
```python
company_ids = request_data.get('company_ids', [])
# –ù–ï–¢ –í–ê–õ–ò–î–ê–¶–ò–ò company_ids
comparison_data = await facade.compare_companies(
    company_ids=company_ids,
    ...
)
```

**–ü–û–°–õ–ï:**
```python
from app.core.access_control import check_company_access

company_ids = request_data.get('company_ids', [])

# –í–ê–õ–ò–î–ê–¶–ò–Ø: –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–∂–¥–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
for company_id in company_ids:
    company = await check_company_access(company_id, current_user, db)
    if not company:
        raise HTTPException(
            status_code=403,
            detail=f"Access denied to company {company_id}"
        )

comparison_data = await facade.compare_companies(
    company_ids=company_ids,
    ...
)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö `company_ids` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 403 –¥–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### –ó–∞–¥–∞—á–∞ 3.6: –ò—Å–ø—Ä–∞–≤–∏—Ç—å `GET /api/v1/competitors/suggest/{company_id}`

**–§–∞–π–ª:** `backend/app/api/v1/endpoints/competitors.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

**–î–û:**
```python
company_uuid = uuid_lib.UUID(company_id)
# –ù–ï–¢ –ü–†–û–í–ï–†–ö–ò –î–û–°–¢–£–ü–ê
suggestions = await facade.suggest_competitors(
    company_id=company_uuid,
    ...
)
```

**–ü–û–°–õ–ï:**
```python
from app.core.access_control import check_company_access

# –ü–†–û–í–ï–†–ö–ê –î–û–°–¢–£–ü–ê
company = await check_company_access(company_id, current_user, db)
if not company:
    raise HTTPException(status_code=404, detail="Company not found")

company_uuid = uuid_lib.UUID(company_id)
suggestions = await facade.suggest_competitors(
    company_id=company_uuid,
    ...
)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404 –¥–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### –ó–∞–¥–∞—á–∞ 3.7: –ò—Å–ø—Ä–∞–≤–∏—Ç—å `GET /api/v1/competitors/activity/{company_id}`

**–§–∞–π–ª:** `backend/app/api/v1/endpoints/competitors.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∑–∞–¥–∞—á–µ 3.6

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404 –¥–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### –ó–∞–¥–∞—á–∞ 3.8: –ò—Å–ø—Ä–∞–≤–∏—Ç—å `GET /api/v1/reports/{report_id}`

**–§–∞–π–ª:** `backend/app/api/v1/endpoints/reports.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

**–î–û:**
```python
report = await report_repo.get_by_id(report_uuid)

if not report:
    raise HTTPException(status_code=404, detail="Report not found")

# –ü–†–û–í–ï–†–ö–ê –î–û–°–¢–£–ü–ê –ü–û–°–õ–ï –ü–û–õ–£–ß–ï–ù–ò–Ø
if report.user_id != current_user.id:
    raise HTTPException(status_code=403, detail="Access denied")
```

**–ü–û–°–õ–ï:**
```python
# –ü–†–û–í–ï–†–ö–ê –î–û–°–¢–£–ü–ê –í SQL –ó–ê–ü–†–û–°–ï
report = await report_repo.get_by_id(report_uuid, user_id=current_user.id)

if not report:
    # –í—Å–µ–≥–¥–∞ 404, –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    raise HTTPException(status_code=404, detail="Report not found")
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] `ReportRepository.get_by_id()` –æ–±–Ω–æ–≤–ª—ë–Ω
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ SQL –∑–∞–ø—Ä–æ—Å–µ
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### –ó–∞–¥–∞—á–∞ 3.9: –û–±–Ω–æ–≤–∏—Ç—å `ReportRepository.get_by_id()`

**–§–∞–π–ª:** `backend/app/domains/reports/repositories/report_repository.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

**–î–û:**
```python
async def get_by_id(
    self,
    report_id: UUID | str,
    *,
    include_relations: bool = False
) -> Optional[Report]:
    stmt = select(Report).where(Report.id == report_id)
    # –ù–ï–¢ –§–ò–õ–¨–¢–†–ê –ü–û user_id
    result = await self.session.execute(stmt)
    return result.scalar_one_or_none()
```

**–ü–û–°–õ–ï:**
```python
async def get_by_id(
    self,
    report_id: UUID | str,
    *,
    user_id: Optional[UUID] = None,  # –ù–û–í–´–ô –ü–ê–†–ê–ú–ï–¢–†
    include_relations: bool = False
) -> Optional[Report]:
    stmt = select(Report).where(Report.id == report_id)
    
    # –ù–û–í–´–ô –§–ò–õ–¨–¢–† –ü–û user_id
    if user_id:
        stmt = stmt.where(Report.user_id == user_id)
    
    result = await self.session.execute(stmt)
    return result.scalar_one_or_none()
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –ü–∞—Ä–∞–º–µ—Ç—Ä `user_id` –¥–æ–±–∞–≤–ª–µ–Ω
- [ ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## –≠—Ç–∞–ø 4: –£–ª—É—á—à–µ–Ω–∏–µ UX

### –ó–∞–¥–∞—á–∞ 4.1: –û–±–Ω–æ–≤–∏—Ç—å DashboardPage - –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

**–§–∞–π–ª:** `frontend/src/pages/DashboardPage.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

**–î–û:**
```tsx
<h2>Competitors</h2>
```

**–ü–û–°–õ–ï:**
```tsx
<h2>
  Your Competitors
  {companies.length > 0 && (
    <span className="text-sm text-gray-500 ml-2">
      ({companies.length} companies)
    </span>
  )}
</h2>
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ–±–Ω–æ–≤–ª—ë–Ω
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–∞–Ω–∏–π
- [ ] UI –≤—ã–≥–ª—è–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –ó–∞–¥–∞—á–∞ 4.2: –û–±–Ω–æ–≤–∏—Ç—å DashboardPage - –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –ø—É—Å—Ç—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

**–§–∞–π–ª:** `frontend/src/pages/DashboardPage.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

**–î–û:**
```tsx
{companies.length === 0 && (
  <div>No companies found</div>
)}
```

**–ü–û–°–õ–ï:**
```tsx
{companies.length === 0 && (
  <div className="text-center py-12">
    <p className="text-lg text-gray-600 mb-4">
      You don't have any competitors yet
    </p>
    <p className="text-sm text-gray-500 mb-6">
      Add your first competitor to start tracking news and updates
    </p>
    <button
      onClick={handleAddCompetitor}
      className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
    >
      Add Your First Competitor
    </button>
  </div>
)}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [ ] –ö–Ω–æ–ø–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] UI –≤—ã–≥–ª—è–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –ó–∞–¥–∞—á–∞ 4.3: –û–±–Ω–æ–≤–∏—Ç—å Header - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–ø–∏—Å–æ–∫

**–§–∞–π–ª:** `frontend/src/components/Header.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

**–î–û:**
```tsx
<div>{user.full_name}</div>
```

**–ü–û–°–õ–ï:**
```tsx
<div>
  <div>{user.full_name}</div>
  {companiesCount > 0 && (
    <div className="text-xs text-gray-500">
      {companiesCount} companies tracked
    </div>
  )}
</div>
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ù—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–∞–Ω–∏–π —á–µ—Ä–µ–∑ API `GET /companies/` (—Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è –ø–æ `user_id`)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–∞–Ω–∏–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
- [ ] –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] UI –≤—ã–≥–ª—è–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –ó–∞–¥–∞—á–∞ 4.4: –û–±–Ω–æ–≤–∏—Ç—å NewsPage - –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

**–§–∞–π–ª:** `frontend/src/pages/NewsPage.tsx` (–∏–ª–∏ –≥–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–æ–≤–æ—Å—Ç–∏)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

**–î–û:**
```tsx
<h2>News</h2>
```

**–ü–û–°–õ–ï:**
```tsx
<h2>
  Your News Feed
  {isAuthenticated && (
    <span className="text-sm text-gray-500 ml-2">
      (filtered by your companies)
    </span>
  )}
</h2>
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –ò–Ω–¥–∏–∫–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞
- [ ] UI –≤—ã–≥–ª—è–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## –≠—Ç–∞–ø 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–¥–∞—á–∞ 5.1: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è access_control.py

**–§–∞–π–ª:** `backend/tests/test_access_control.py` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

**–¢–µ—Å—Ç—ã:**
- [ ] `test_check_company_access_user_owns_company()` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ª–∞–¥–µ–µ—Ç –∫–æ–º–ø–∞–Ω–∏–µ–π
- [ ] `test_check_company_access_user_does_not_own_company()` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–ª–∞–¥–µ–µ—Ç –∫–æ–º–ø–∞–Ω–∏–µ–π
- [ ] `test_check_company_access_global_company()` - –≥–ª–æ–±–∞–ª—å–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è
- [ ] `test_check_news_access_user_owns_company()` - –Ω–æ–≤–æ—Å—Ç—å –∏–∑ –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] `test_check_news_access_user_does_not_own_company()` - –Ω–æ–≤–æ—Å—Ç—å –∏–∑ —á—É–∂–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
- [ ] `test_get_user_company_ids()` - –ø–æ–ª—É—á–µ–Ω–∏–µ ID –∫–æ–º–ø–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ü–æ–∫—Ä—ã—Ç–∏–µ > 80%

### –ó–∞–¥–∞—á–∞ 5.2: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

**–§–∞–π–ª:** `backend/tests/test_personalization_isolation.py` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

**–¢–µ—Å—Ç—ã:**
- [ ] `test_user_a_cannot_see_user_b_companies()` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê –Ω–µ –≤–∏–¥–∏—Ç –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë
- [ ] `test_user_a_cannot_see_user_b_news()` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê –Ω–µ –≤–∏–¥–∏—Ç –Ω–æ–≤–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë
- [ ] `test_user_a_cannot_see_user_b_reports()` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê –Ω–µ –≤–∏–¥–∏—Ç –æ—Ç—á—ë—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë
- [ ] `test_user_sees_all_own_companies()` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –≤—Å–µ —Å–≤–æ–∏ –∫–æ–º–ø–∞–Ω–∏–∏
- [ ] `test_user_sees_all_own_news()` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –≤—Å–µ –Ω–æ–≤–æ—Å—Ç–∏ —Å–≤–æ–∏—Ö –∫–æ–º–ø–∞–Ω–∏–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ü–æ–∫—Ä—ã—Ç–∏–µ > 80%

### –ó–∞–¥–∞—á–∞ 5.3: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –∑–∞—â–∏—Ç—ã –æ—Ç –ø–æ–¥–º–µ–Ω—ã ID

**–§–∞–π–ª:** `backend/tests/test_personalization_security.py` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

**–¢–µ—Å—Ç—ã:**
- [ ] `test_cannot_access_other_user_company_by_id()` - –Ω–µ–ª—å–∑—è –ø–æ–ª—É—á–∏—Ç—å —á—É–∂—É—é –∫–æ–º–ø–∞–Ω–∏—é –ø–æ ID
- [ ] `test_cannot_access_other_user_news_by_id()` - –Ω–µ–ª—å–∑—è –ø–æ–ª—É—á–∏—Ç—å —á—É–∂—É—é –Ω–æ–≤–æ—Å—Ç—å –ø–æ ID
- [ ] `test_cannot_access_other_user_report_by_id()` - –Ω–µ–ª—å–∑—è –ø–æ–ª—É—á–∏—Ç—å —á—É–∂–æ–π –æ—Ç—á—ë—Ç –ø–æ ID
- [ ] `test_cannot_compare_other_user_companies()` - –Ω–µ–ª—å–∑—è —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —á—É–∂–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
- [ ] `test_cannot_get_suggestions_for_other_user_company()` - –Ω–µ–ª—å–∑—è –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —á—É–∂–æ–π –∫–æ–º–ø–∞–Ω–∏–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ü–æ–∫—Ä—ã—Ç–∏–µ > 80%

---

## –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

### Backend

- [ ] –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `check_company_access()` –∏–ª–∏ `check_news_access()`
- [ ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ `user_id` –∫–æ–º–ø–∞–Ω–∏–π (–ù–ï –ø–æ `subscribed_companies`)
- [ ] –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ SQL –∑–∞–ø—Ä–æ—Å–∞—Ö (–Ω–µ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö)
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ù–µ—Ç –ª–∏–Ω—Ç–µ—Ä –æ—à–∏–±–æ–∫

### Frontend

- [ ] –ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã ("Your Competitors", "Your News Feed")
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–∞–Ω–∏–π
- [ ] –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –ø—É—Å—Ç—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [ ] –ò–Ω–¥–∏–∫–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞
- [ ] UI –≤—ã–≥–ª—è–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [ ] README –æ–±–Ω–æ–≤–ª—ë–Ω —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
- [ ] –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [ ] API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)

---

## –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. **–≠—Ç–∞–ø 1** - –°–æ–∑–¥–∞—Ç—å `access_control.py` (–æ—Å–Ω–æ–≤–∞ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫)
2. **–≠—Ç–∞–ø 2** - –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –Ω–æ–≤–æ—Å—Ç–µ–π (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã)
3. **–≠—Ç–∞–ø 3** - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å–∞–º (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
4. **–≠—Ç–∞–ø 4** - –£–ª—É—á—à–∏—Ç—å UX (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
5. **–≠—Ç–∞–ø 5** - –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)

---

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á:

1. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ —Å–≤–æ–∏—Ö –∫–æ–º–ø–∞–Ω–∏–π (`user_id`)
2. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —á—É–∂–∏–º —Ä–µ—Å—É—Ä—Å–∞–º
3. ‚úÖ –ï–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞: "List Competitor" –∏ –Ω–æ–≤–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫
4. ‚úÖ –£–ª—É—á—à–µ–Ω UX —Å —è–≤–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑—å—é
5. ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
6. ‚úÖ –ö–æ–¥ –ª–µ–≥–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å (—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)

---

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **–í–∞–∂–Ω–æ:** –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `user_id` –∫–æ–º–ø–∞–Ω–∏–π, –∞ –ù–ï `subscribed_companies`
- **–í–∞–∂–Ω–æ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –¥–æ–ª–∂–Ω–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ SQL –∑–∞–ø—Ä–æ—Å–µ, –∞ –Ω–µ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- **–í–∞–∂–Ω–æ:** –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 404 –¥–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ (–Ω–µ 403), —á—Ç–æ–±—ã –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é


