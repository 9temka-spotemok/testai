# –ü–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ Celery –∏ Scraper

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-19  
**–°—Ç–∞—Ç—É—Å:** üü° –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

---

## üìã –û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º—ã Scraper'–∞
1. ‚ùå **–õ–∏—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ä–µ—Å—É—Ä—Å–∞–º (404)** - —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç "–º–µ—Ä—Ç–≤—ã–µ" URL
2. ‚ùå **–î—É–±–ª–∏–∫–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤** - –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ URL –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ (–≤–Ω—É—Ç—Ä–∏ –≤–æ—Ä–∫–µ—Ä–∞ –∏ –º–µ–∂–¥—É –≤–æ—Ä–∫–µ—Ä–∞–º–∏)
3. ‚ùå **–ù–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ URL** - `/blog` –∏ `/blog/` —Å—á–∏—Ç–∞—é—Ç—Å—è —Ä–∞–∑–Ω—ã–º–∏ URL
4. ‚ùå **–ù–µ—Ç –ø–µ—Ä–≤–∏—á–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏** - –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

### –ü—Ä–æ–±–ª–µ–º—ã Celery
1. ‚ùå **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ event loop –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏** - –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã ~100-200 –º—Å –Ω–∞ –∑–∞–¥–∞—á—É
2. ‚ùå **NullPool –¥–ª—è DB —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π** - –∫–∞–∂–¥–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ (~100 –º—Å)
3. ‚ùå **–õ–∏–Ω–µ–π–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤** - –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
4. ‚ùå **–ù–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –æ—á–µ—Ä–µ–¥–µ–π** - –∑–∞–¥–∞—á–∏ –æ—Ç Telegram –±–æ—Ç–∞ –∂–¥—É—Ç —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
5. ‚ùå **–ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –≤–æ—Ä–∫–µ—Ä–æ–≤** - –æ–¥–∏–Ω –≤–æ—Ä–∫–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Ç–∏–ø—ã –∑–∞–¥–∞—á

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- ‚úÖ –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ 60-80% (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ 404 –∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
- ‚úÖ –£—Å–∫–æ—Ä–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á –Ω–∞ 50%+ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è event loop –∏ DB –ø—É–ª–∞)
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ (10-20x —É—Å–∫–æ—Ä–µ–Ω–∏–µ)
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç Telegram –±–æ—Ç–∞ (< 1 —Å–µ–∫)

---

## üéØ –§–∞–∑–∞ 0: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Scraper (5-6 –¥–Ω–µ–π)

### –≠—Ç–∞–ø 0.1: –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è URL (1 –¥–µ–Ω—å)

**–¶–µ–ª—å:** –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `backend/app/scrapers/universal_scraper.py`

**–®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `_normalize_url()` –≤ `UniversalBlogScraper`:**
   ```python
   def _normalize_url(self, url: str) -> str:
       """
       –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç URL –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:
       - –£–±–∏—Ä–∞–µ—Ç trailing slash
       - –ü—Ä–∏–≤–æ–¥–∏—Ç –¥–æ–º–µ–Ω –∫ lowercase
       - –£–±–∏—Ä–∞–µ—Ç query params –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
       - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π URL
       """
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å in-memory –∫—ç—à `_request_cache` –≤ `__init__`:**
   ```python
   self._request_cache: Dict[Tuple[str, str], Tuple[str, str, float]] = {}
   # –ö–ª—é—á: (normalized_url, company_name)
   # –ó–Ω–∞—á–µ–Ω–∏–µ: (html, final_url, fetched_at)
   ```

3. **–û–±–Ω–æ–≤–∏—Ç—å `_fetch_with_retry()`:**
   - –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à –ø–µ—Ä–µ–¥ `client.get()`
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫—ç—à –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
   - –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –ª–æ–≥–∞—Ö –¥–ª—è –æ–¥–Ω–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞
- ‚úÖ –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ 30-50%

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ó–∞–ø—É—Å—Ç–∏—Ç—å scraper –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –ò–∑–º–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–æ/–ø–æ—Å–ª–µ

---

### –≠—Ç–∞–ø 0.2: –ú–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è URL (1 –¥–µ–Ω—å)

**–¶–µ–ª—å:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ–¥–Ω–æ–≥–æ URL —Ä–∞–∑–Ω—ã–º–∏ –≤–æ—Ä–∫–µ—Ä–∞–º–∏

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `backend/app/scrapers/rate_limiter.py` (—Ä–∞—Å—à–∏—Ä–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π)
- `backend/app/core/config.py`

**–®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **–°–æ–∑–¥–∞—Ç—å –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é `RequestLockBackend` (Context7 –ø–æ–¥—Ö–æ–¥):**
   ```python
   # backend/app/scrapers/request_lock.py (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
   class RequestLockBackend(Protocol):
       async def acquire(self, url: str, ttl: int) -> bool
       async def release(self, url: str) -> None
   
   class RedisRequestLockBackend(RequestLockBackend):
       """–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Redis SET NX"""
   
   class InMemoryRequestLockBackend(RequestLockBackend):
       """–î–ª—è —Ç–µ—Å—Ç–æ–≤"""
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å `SourceFetchLock` –≤ `rate_limiter.py`:**
   ```python
   class SourceFetchLock:
       def __init__(self, backend: RequestLockBackend)
       async def acquire(self, url: str, timeout: int) -> bool
       async def release(self, url: str) -> None
   ```

3. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `UniversalBlogScraper._fetch_with_retry()`:**
   - –ë—Ä–∞—Ç—å –ª–æ–∫ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º: `await lock.acquire(normalized_url, timeout)`
   - –ï—Å–ª–∏ –ª–æ–∫ –Ω–µ –ø–æ–ª—É—á–µ–Ω ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å URL (–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å "already fetching")
   - –û—Å–≤–æ–±–æ–∂–¥–∞—Ç—å –ª–æ–∫ –ø–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞: `await lock.release(normalized_url)`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ–∂–¥—É –≤–æ—Ä–∫–µ—Ä–∞–º–∏
- ‚úÖ –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –µ—â–µ –Ω–∞ 20-30%

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –º–µ–∂–¥—É –≤–æ—Ä–∫–µ—Ä–∞–º–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Redis –∫–ª—é—á–∏ `scrape:{normalized_url}`

---

### –≠—Ç–∞–ø 0.3: –ü–∞–º—è—Ç—å –æ "–º–µ—Ä—Ç–≤—ã—Ö" –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö (SourceHealthService) (2 –¥–Ω—è)

**–¶–µ–ª—å:** –ó–∞–ø–æ–º–∏–Ω–∞—Ç—å URL, –∫–æ—Ç–æ—Ä—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 404, –∏ –Ω–µ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –Ω–∏–º

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `backend/app/domains/news/services/source_health_service.py` (–Ω–æ–≤—ã–π)
- `backend/app/models/crawl.py` (—Ä–∞—Å—à–∏—Ä–∏—Ç—å SourceProfile)
- `backend/app/scrapers/universal_scraper.py`
- `backend/app/domains/news/services/scraper_service.py`
- `backend/app/domains/news/scrapers/adapters.py`

**–®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **–°–æ–∑–¥–∞—Ç—å `SourceHealthService`:**
   ```python
   # backend/app/domains/news/services/source_health_service.py
   class SourceHealthService:
       async def get_dead_urls(self, company_id: UUID) -> Set[str]
       async def record_result(
           self, 
           company_id: UUID, 
           source_url: str, 
           success: bool, 
           status: int, 
           items_count: int
       ) -> None
       async def should_skip_url(self, company_id: UUID, source_url: str) -> bool
   ```

2. **–†–∞—Å—à–∏—Ä–∏—Ç—å `SourceProfile.metadata` (JSONB):**
   ```python
   # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ metadata.dead_urls:
   {
       "normalized_url": {
           "status": "disabled" | "recovering" | "healthy",
           "fail_count": 5,
           "last_error": "404 Not Found",
           "disabled_until": "2025-01-20T12:00:00Z",
           "last_success": "2025-01-15T10:00:00Z"
       }
   }
   ```

3. **–û–±–Ω–æ–≤–∏—Ç—å `ScraperProvider.scrape_company()`:**
   - –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `skip_urls: Optional[Set[str]] = None`
   - `UniversalScraperProvider` –ø–µ—Ä–µ–¥–∞–µ—Ç `skip_urls` –≤ `UniversalBlogScraper`

4. **–û–±–Ω–æ–≤–∏—Ç—å `UniversalBlogScraper.scrape_company_blog()`:**
   - –ü—Ä–∏–Ω–∏–º–∞—Ç—å `skip_urls: Optional[Set[str]]`
   - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å `source_configs` –ø–æ `skip_urls` –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
   - –ü–æ—Å–ª–µ `_scrape_source()` –≤—ã–∑—ã–≤–∞—Ç—å `SourceHealthService.record_result()`

5. **–õ–æ–≥–∏–∫–∞ –≤ `SourceHealthService.record_result()`:**
   ```python
   if status in {404, 410} or items_count == 0:
       fail_count += 1
       if fail_count >= 5:
           status = "disabled"
           disabled_until = now + timedelta(days=1)
   elif success:
       fail_count = 0
       status = "healthy"
       last_success = now
   ```

6. **–ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `source_configs`:**
   - –ó–∞–≥—Ä—É–∂–∞—Ç—å `dead_urls` –∏–∑ `SourceProfile` —á–µ—Ä–µ–∑ `SourceHealthService`
   - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å URL —Å `status == "disabled"` –∏ `disabled_until > now`
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å: `source_status=disabled` –∏–ª–∏ `source_status=recovering`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ–≥–æ–Ω–∞ 404-–∑–∞–ø—Ä–æ—Å—ã –∏—Å–∫–ª—é—á–µ–Ω—ã
- ‚úÖ –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ 40-60%
- ‚úÖ –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç `source_status=disabled` –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã—Ö URL

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º URL
- –ó–∞–ø—É—Å—Ç–∏—Ç—å scraper 5 —Ä–∞–∑
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ—Å–ª–µ 5-–≥–æ —Ä–∞–∑–∞ URL –æ—Ç–∫–ª—é—á–µ–Ω
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `SourceProfile.metadata.dead_urls` –≤ –ë–î

---

### –≠—Ç–∞–ø 0.4: –ü–µ—Ä–≤–∏—á–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ (1 –¥–µ–Ω—å)

**–¶–µ–ª—å:** –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–æ–º–ø–∞–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `backend/app/api/v1/endpoints/companies.py`
- `backend/app/tasks/scraping.py`
- `backend/app/domains/news/services/scraper_service.py`

**–®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É `scan_company_sources_initial()`:**
   ```python
   @celery_app.task(bind=True)
   def scan_company_sources_initial(self, company_id: str):
       """
       –ü–µ—Ä–≤–∏—á–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏.
       –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∞–∂–µ 404 URL –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ SourceHealthService.
       """
   ```

2. **–û–±–Ω–æ–≤–∏—Ç—å `scan_company` endpoint:**
   - –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ –≤—ã–∑—ã–≤–∞—Ç—å `scan_company_sources_initial.delay(company_id)`
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å: "Initial source scan queued for company {company_id}"

3. **–û–±–Ω–æ–≤–∏—Ç—å `scrape_ai_blogs`:**
   - –î–ª—è –Ω–æ–≤—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π (created_at > now - 1 day) –≤—ã–∑—ã–≤–∞—Ç—å `scan_company_sources_initial`
   - –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ñ–ª–∞–≥ `sources_initialized` –≤ Company

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ù–æ–≤—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∞—é—Ç –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç—É –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- ‚úÖ –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–∫–ª—é—á–∞—é—Ç 404

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–æ–º–ø–∞–Ω–∏—é —á–µ—Ä–µ–∑ API
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–¥–∞—á–∞ `scan_company_sources_initial` —Å–æ–∑–¥–∞–Ω–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `SourceProfile.metadata` –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

## üöÄ –§–∞–∑–∞ 1: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Celery (3-4 –¥–Ω—è)

### –≠—Ç–∞–ø 1.1: –û–±—â–∏–π event loop –¥–ª—è –≤–æ—Ä–∫–µ—Ä–æ–≤ (1 –¥–µ–Ω—å)

**–¶–µ–ª—å:** –£–±—Ä–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ event loop –Ω–∞ –∫–∞–∂–¥—É—é –∑–∞–¥–∞—á—É

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `backend/app/core/celery_async.py` (–Ω–æ–≤—ã–π)
- `backend/app/tasks/scraping.py`
- `backend/app/tasks/digest.py`
- `backend/app/tasks/notifications.py`
- `backend/app/tasks/analytics.py`
- `backend/app/tasks/competitors.py`

**–®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **–°–æ–∑–¥–∞—Ç—å `backend/app/core/celery_async.py`:**
   ```python
   import asyncio
   import nest_asyncio
   import threading
   from typing import Callable, Awaitable, TypeVar, Any
   
   T = TypeVar('T')
   
   _loop_lock = threading.Lock()
   _worker_loop: Optional[asyncio.AbstractEventLoop] = None
   
   def get_or_create_loop() -> asyncio.AbstractEventLoop:
       """–ü–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å event loop –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞"""
       global _worker_loop
       with _loop_lock:
           if _worker_loop is None or _worker_loop.is_closed():
               _worker_loop = asyncio.new_event_loop()
               asyncio.set_event_loop(_worker_loop)
               nest_asyncio.apply(_worker_loop)
           return _worker_loop
   
   def run_async_task(coro: Awaitable[T]) -> T:
       """–í—ã–ø–æ–ª–Ω–∏—Ç—å async —Ñ—É–Ω–∫—Ü–∏—é –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º event loop"""
       loop = get_or_create_loop()
       if loop.is_running():
           # –ï—Å–ª–∏ loop —É–∂–µ –∑–∞–ø—É—â–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º nest_asyncio
           return asyncio.run_coroutine_threadsafe(coro, loop).result()
       else:
           return loop.run_until_complete(coro)
   ```

2. **–ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ `_run_async()` –Ω–∞ `run_async_task()`:**
   - `backend/app/tasks/scraping.py`
   - `backend/app/tasks/digest.py`
   - `backend/app/tasks/notifications.py`

3. **–û–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ `nest_asyncio` –∏ `asyncio.run()`:**
   - `backend/app/tasks/analytics.py` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `run_async_task()`
   - `backend/app/tasks/competitors.py` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `run_async_task()`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ù–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ event loop –Ω–∞ –∫–∞–∂–¥—É—é –∑–∞–¥–∞—á—É
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è ~100 –º—Å –Ω–∞ –∑–∞–¥–∞—á—É
- ‚úÖ –í—Å–µ –∑–∞–¥–∞—á–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–∏–ø—ã –∑–∞–¥–∞—á
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ event loop
- –ò–∑–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á –¥–æ/–ø–æ—Å–ª–µ

---

### –≠—Ç–∞–ø 1.2: –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ NullPool (1 –¥–µ–Ω—å)

**–¶–µ–ª—å:** –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DB —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `backend/app/core/celery_database.py` (–Ω–æ–≤—ã–π)
- `backend/app/tasks/digest.py`
- `backend/app/tasks/notifications.py`

**–®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **–°–æ–∑–¥–∞—Ç—å `backend/app/core/celery_database.py`:**
   ```python
   from sqlalchemy.ext.asyncio import create_async_engine, async_sessionmaker, AsyncSession
   from app.core.config import settings
   
   # –û–±—â–∏–π engine –¥–ª—è Celery –∑–∞–¥–∞—á —Å –ø—É–ª–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
   celery_engine = create_async_engine(
       settings.DATABASE_URL,
       echo=settings.DEBUG,
       pool_pre_ping=True,
       pool_recycle=300,
       pool_size=5,
       max_overflow=10,
   )
   
   CelerySessionLocal = async_sessionmaker(
       celery_engine,
       class_=AsyncSession,
       expire_on_commit=False,
   )
   ```

2. **–ó–∞–º–µ–Ω–∏—Ç—å `NullPool` –Ω–∞ –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:**
   - –í `backend/app/tasks/digest.py`: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `CelerySessionLocal`
   - –í `backend/app/tasks/notifications.py`: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `CelerySessionLocal`
   - –£–¥–∞–ª–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö `_TASK_ENGINE` —Å `NullPool`

3. **–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ –ø—É–ª:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `async with CelerySessionLocal() as db:` –≤–µ–∑–¥–µ
   - –ù–µ –∑–∞–±—ã–≤–∞—Ç—å `await db.close()` –≤ finally –±–ª–æ–∫–∞—Ö

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ù–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–∞ –∫–∞–∂–¥—É—é –∑–∞–¥–∞—á—É
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è ~100 –º—Å –Ω–∞ –∑–∞–¥–∞—á—É
- ‚úÖ –ù–µ—Ç —É—Ç–µ—á–µ–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ –º–µ—Ç—Ä–∏–∫–∏)

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–¥–∞—á –ø–æ–¥—Ä—è–¥
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ "too many connections"

---

### –≠—Ç–∞–ø 1.3: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –¥–ª—è Telegram (1 –¥–µ–Ω—å)

**–¶–µ–ª—å:** –û—Ç–¥–µ–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –¥–ª—è –∑–∞–¥–∞—á –æ—Ç Telegram –±–æ—Ç–∞

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `backend/app/celery_app.py`
- `backend/app/api/v1/endpoints/telegram.py`
- `docker-compose.yml`
- `backend/start-worker.sh`

**–®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **–î–æ–±–∞–≤–∏—Ç—å –æ—á–µ—Ä–µ–¥—å `telegram` –≤ `celery_app.py`:**
   ```python
   celery_app.conf.task_queues = (
       Queue("celery", Exchange("celery"), routing_key="celery"),
       Queue("analytics", Exchange("analytics"), routing_key="analytics"),
       Queue("telegram", Exchange("telegram"), routing_key="telegram"),
   )
   
   celery_app.conf.task_routes = {
       "app.tasks.analytics.*": {"queue": "analytics"},
       "app.tasks.digest.generate_user_digest": {"queue": "telegram"},
   }
   ```

2. **–û–±–Ω–æ–≤–∏—Ç—å `telegram.py` endpoint:**
   ```python
   # –ó–∞–º–µ–Ω–∏—Ç—å delay() –Ω–∞ apply_async() —Å —Ç–∞–π–º–∞—É—Ç–∞–º–∏
   task = generate_user_digest.apply_async(
       args=[str(user_prefs.user_id), "daily"],
       queue="telegram",
       countdown=0,
       expires=None,
       connection_retry=False,
   )
   ```

3. **–û–±–Ω–æ–≤–∏—Ç—å `docker-compose.yml`:**
   ```yaml
   celery-worker-telegram:
     # ... existing config ...
     command: celery -A app.celery_app worker --loglevel=info -Q telegram --concurrency=4 --prefetch-multiplier=2
   ```

4. **–û–±–Ω–æ–≤–∏—Ç—å `start-worker.sh` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤**

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ó–∞–¥–∞—á–∏ –æ—Ç Telegram –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
- ‚úÖ –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ < 1 —Å–µ–∫—É–Ω–¥—ã

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–¥–∞—á–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å `telegram`
- –ò–∑–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

---

## üìä –§–∞–∑–∞ 2: –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ (2-3 –¥–Ω—è)

### –≠—Ç–∞–ø 2.1: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ (1 –¥–µ–Ω—å)

**–¶–µ–ª—å:** –£–±—Ä–∞—Ç—å –ª–∏–Ω–µ–π–Ω—ã–π —Ü–∏–∫–ª, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `backend/app/tasks/digest.py`
- `backend/app/celery_app.py`
- `docker-compose.yml`

**–®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **–ò–∑–º–µ–Ω–∏—Ç—å `generate_daily_digests`:**
   ```python
   async def _generate_daily_digests_async():
       async with CelerySessionLocal() as db:
           # –§–∞–∑–∞ 1: –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
           result = await db.execute(
               select(UserPreferences).where(
                   UserPreferences.digest_enabled == True,
                   UserPreferences.digest_frequency.in_(["daily", "custom"])
               )
           )
           user_prefs_list = result.scalars().all()
           
           # –§–∞–∑–∞ 2: –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á
           tasks = []
           for user_prefs in user_prefs_list:
               if not _is_user_due_now_precise(user_prefs, user_prefs.digest_frequency):
                   continue
               
               task = generate_user_digest.delay(
                   str(user_prefs.user_id), 
                   user_prefs.digest_frequency,
                   tracked_only=(user_prefs.telegram_digest_mode == 'tracked')
               )
               tasks.append(task.id)
           
           return {"status": "queued", "task_count": len(tasks)}
   ```

2. **–°–æ–∑–¥–∞—Ç—å –æ—á–µ—Ä–µ–¥—å `digests`:**
   - –í `celery_app.py` –¥–æ–±–∞–≤–∏—Ç—å `Queue("digests")`
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–æ—É—Ç–∏–Ω–≥: `"app.tasks.digest.generate_user_digest": {"queue": "digests"}`

3. **–°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤–æ—Ä–∫–µ—Ä –¥–ª—è `digests`:**
   ```yaml
   celery-worker-digests:
     command: celery -A app.celery_app worker --loglevel=info -Q digests --concurrency=4 --prefetch-multiplier=1
   ```

4. **–û–±–Ω–æ–≤–∏—Ç—å Telegram handler:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `apply_async(queue="digests_high")` –¥–ª—è —Ä—É—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –°—Ä–∞–∑—É –æ—Ç–≤–µ—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é "–≥–æ—Ç–æ–≤–∏–º –¥–∞–π–¥–∂–µ—Å—Ç..."
   - –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–π–¥–∂–µ—Å—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ –≤ 10-20 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ
- ‚úÖ Telegram –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ –¥–ª—è 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–¥–∞—á–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –≤–æ—Ä–∫–µ—Ä–∞–º
- –ò–∑–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

### –≠—Ç–∞–ø 2.2: Rate limiting –¥–ª—è Telegram (0.5 –¥–Ω—è)

**–¶–µ–ª—å:** –ò–∑–±–µ–∂–∞—Ç—å rate limit –ø—Ä–∏ –º–∞—Å—Å–æ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `backend/app/services/telegram_service.py`
- `backend/app/core/rate_limiter.py` (—Ä–∞—Å—à–∏—Ä–∏—Ç—å)

**–®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **–î–æ–±–∞–≤–∏—Ç—å `TelegramRateLimiter`:**
   ```python
   class TelegramRateLimiter:
       def __init__(self, max_per_second: int = 20):
           self._semaphore = asyncio.Semaphore(max_per_second)
           self._last_reset = time.time()
       
       async def acquire(self, chat_id: str):
           await self._semaphore.acquire()
       
       def release(self, chat_id: str):
           self._semaphore.release()
   ```

2. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `telegram_service.send_digest()`:**
   ```python
   await rate_limiter.acquire(chat_id)
   try:
       await bot.send_message(chat_id, text)
   finally:
       rate_limiter.release(chat_id)
   ```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ rate limit –æ—Ç Telegram API
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ 20/—Å–µ–∫

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å 100 —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–¥—Ä—è–¥
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ rate limit

---

## üîß –§–∞–∑–∞ 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Scraping Pipeline (2-3 –¥–Ω—è)

### –≠—Ç–∞–ø 3.1: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ –∫–æ–º–ø–∞–Ω–∏—è–º (1 –¥–µ–Ω—å)

**–¶–µ–ª—å:** –í–º–µ—Å—Ç–æ –æ–¥–Ω–æ–π –±–æ–ª—å—à–æ–π –∑–∞–¥–∞—á–∏ - –º–µ–ª–∫–∏–µ –∑–∞–¥–∞—á–∏ –ø–æ –∫–æ–º–ø–∞–Ω–∏—è–º

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `backend/app/tasks/scraping.py`
- `backend/app/services/crawl_schedule_service.py`

**–®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **–ò–∑–º–µ–Ω–∏—Ç—å `scrape_ai_blogs`:**
   ```python
   @celery_app.task(bind=True)
   def scrape_ai_blogs(self):
       """–¢–æ–ª—å–∫–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ - —Å–æ–∑–¥–∞–µ—Ç –∑–∞–¥–∞—á–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–ø–∞–Ω–∏–∏"""
       result = _run_async(_scrape_ai_blogs_plan_async)
       return result
   
   async def _scrape_ai_blogs_plan_async():
       async with CelerySessionLocal() as db:
           # –ü–æ–ª—É—á–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —Å–∫—Ä–µ–π–ø–∏—Ç—å
           companies = await get_companies_due_for_scraping(db)
           
           tasks = []
           for company in companies:
               task = scrape_company_news.delay(str(company.id))
               tasks.append(task.id)
           
           return {"status": "queued", "task_count": len(tasks)}
   ```

2. **–°–æ–∑–¥–∞—Ç—å `scrape_company_news(company_id)`:**
   ```python
   @celery_app.task(bind=True)
   def scrape_company_news(self, company_id: str):
       """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–¥–Ω—É –∫–æ–º–ø–∞–Ω–∏—é"""
       result = _run_async(_scrape_company_news_async, company_id)
       return result
   ```

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `CrawlScheduleService`:**
   - `compute_effective_schedule()` - –∫–∞–∫–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –Ω—É–∂–Ω–æ —Å–∫—Ä–µ–π–ø–∏—Ç—å
   - `record_run_start/result()` - –∑–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –õ—É—á—à–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è –æ—à–∏–±–æ–∫ (–æ—à–∏–±–∫–∞ –æ–¥–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ)

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ó–∞–ø—É—Å—Ç–∏—Ç—å scraping –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–º–ø–∞–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–¥–∞—á–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ

---

### –≠—Ç–∞–ø 3.2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ crawl_schedules (1 –¥–µ–Ω—å)

**–¶–µ–ª—å:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–∏—Å—Ç–µ–º—É —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `backend/app/services/crawl_schedule_service.py`
- `backend/app/tasks/scraping.py`

**–®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **–û–±–Ω–æ–≤–∏—Ç—å `scrape_ai_blogs`:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `CrawlScheduleService.compute_effective_schedule()`
   - –°–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–π —Å –∏—Å—Ç–µ–∫—à–∏–º TTL

2. **–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É `scrape_company_source(profile_id)`:**
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–º–ø–∞–Ω–∏–∏
   - –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `CrawlRun`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π
- ‚úÖ –ó–∞–¥–∞—á–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω—É–∂–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–¥–∞—á–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ `CrawlRun`

---

## üìà –§–∞–∑–∞ 4: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (2 –¥–Ω—è)

### –≠—Ç–∞–ø 4.1: –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (1 –¥–µ–Ω—å)

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `backend/app/instrumentation/celery_metrics.py`
- `observability/grafana/celery_dashboard.json`

**–®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏:**
   - `scraper_requests_total` (–ø–æ —Å—Ç–∞—Ç—É—Å—É: 200, 404, timeout)
   - `scraper_dead_urls_count` (gauge)
   - `scraper_duplicate_requests_total` (counter)
   - `digests_pending` (gauge - —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏)
   - `digests_duration_seconds` (histogram)

2. **–û–±–Ω–æ–≤–∏—Ç—å Grafana dashboard:**
   - –î–æ–±–∞–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫
   - –î–æ–±–∞–≤–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ Prometheus
- ‚úÖ Dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

### –≠—Ç–∞–ø 4.2: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (1 –¥–µ–Ω—å)

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `README.md`
- `docs/SCRAPER_SOURCE_HEALTH.md` (–Ω–æ–≤—ã–π)
- `docs/DIAGNOSTIC_SUMMARY.md`

**–®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **–û–±–Ω–æ–≤–∏—Ç—å README:**
   - –†–∞–∑–¥–µ–ª –ø—Ä–æ SourceHealthService
   - –†–∞–∑–¥–µ–ª –ø—Ä–æ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤
   - –†–∞–∑–¥–µ–ª –ø—Ä–æ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—é –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤
   - –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –∏ –∏—Ö –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å

2. **–°–æ–∑–¥–∞—Ç—å `SCRAPER_SOURCE_HEALTH.md`:**
   - –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞ –∑–¥–æ—Ä–æ–≤—å—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
   - –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ URL
   - –ö–∞–∫ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫
   - SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

3. **–û–±–Ω–æ–≤–∏—Ç—å `DIAGNOSTIC_SUMMARY.md`:**
   - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å–æ scraper'–æ–º
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–∞—è –∏ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è
- ‚úÖ –õ–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö

---

## üìÖ –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞

| –§–∞–∑–∞ | –≠—Ç–∞–ø | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|------|------|--------------|-----------|
| 0 | 0.1 –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è URL | 1 –¥–µ–Ω—å | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| 0 | 0.2 –ú–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ | 1 –¥–µ–Ω—å | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| 0 | 0.3 SourceHealthService | 2 –¥–Ω—è | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| 0 | 0.4 –ü–µ—Ä–≤–∏—á–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è | 1 –¥–µ–Ω—å | üü° –í–∞–∂–Ω–æ |
| 1 | 1.1 –û–±—â–∏–π event loop | 1 –¥–µ–Ω—å | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| 1 | 1.2 –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π | 1 –¥–µ–Ω—å | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| 1 | 1.3 –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ—á–µ—Ä–µ–¥—å Telegram | 1 –¥–µ–Ω—å | üü° –í–∞–∂–Ω–æ |
| 2 | 2.1 –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ | 1 –¥–µ–Ω—å | üü° –í–∞–∂–Ω–æ |
| 2 | 2.2 Rate limiting Telegram | 0.5 –¥–Ω—è | üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ |
| 3 | 3.1 –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ –∫–æ–º–ø–∞–Ω–∏—è–º | 1 –¥–µ–Ω—å | üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ |
| 3 | 3.2 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ crawl_schedules | 1 –¥–µ–Ω—å | üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ |
| 4 | 4.1 –ú–µ—Ç—Ä–∏–∫–∏ | 1 –¥–µ–Ω—å | üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ |
| 4 | 4.2 –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | 1 –¥–µ–Ω—å | üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ |

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** 14-18 –¥–Ω–µ–π

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –ø—Ä–æ–µ–∫—Ç–∞

### Scraper
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –ª–æ–≥–∞–º)
- ‚úÖ 404-–∑–∞–ø—Ä–æ—Å—ã –∏—Å–∫–ª—é—á–µ–Ω—ã –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ–≥–æ–Ω–∞
- ‚úÖ –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ 60-80%
- ‚úÖ –õ–æ–≥–∏ —á–∏—â–µ (–Ω–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–∞–ø—Ä–æ—Å–æ–≤)

### Celery
- ‚úÖ –ó–∞–¥–∞—á–∏ –æ—Ç Telegram –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è < 1 —Å–µ–∫—É–Ω–¥—ã
- ‚úÖ –î–∞–π–¥–∂–µ—Å—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (10-20x —É—Å–∫–æ—Ä–µ–Ω–∏–µ)
- ‚úÖ –û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á —Å–æ–∫—Ä–∞—â–µ–Ω–æ –Ω–∞ 50%+
- ‚úÖ –ù–µ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–π –ø—Ä–∏ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–µ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥—å

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ Prometheus
- ‚úÖ Dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ê–ª–µ—Ä—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫

---

## üß™ –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### Unit —Ç–µ—Å—Ç—ã
- –¢–µ—Å—Ç—ã –¥–ª—è `_normalize_url()`
- –¢–µ—Å—Ç—ã –¥–ª—è `SourceHealthService`
- –¢–µ—Å—Ç—ã –¥–ª—è `RequestLockBackend`
- –¢–µ—Å—Ç—ã –¥–ª—è `run_async_task()`

### Integration —Ç–µ—Å—Ç—ã
- –¢–µ—Å—Ç—ã –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- –¢–µ—Å—Ç—ã –¥–ª—è –º–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- –¢–µ—Å—Ç—ã –¥–ª—è SourceHealthService —Å –ë–î
- –¢–µ—Å—Ç—ã –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤

### E2E —Ç–µ—Å—Ç—ã
- –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª scraping —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç Telegram –±–æ—Ç–∞

---

## üö® –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã event loop –≤ multiprocessing
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `nest_asyncio` –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –≤—Å–µ—Ö —Ç–∏–ø–∞—Ö –∑–∞–¥–∞—á

### –†–∏—Å–∫ 2: –£—Ç–µ—á–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø—Ä–∏ –ø—É–ª–µ
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –¢—â–∞—Ç–µ–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—É–ª–∞

### –†–∏—Å–∫ 3: –†–µ–≥—Ä–µ—Å—Å–∏–∏ –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞, –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π rollout

### –†–∏—Å–∫ 4: Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** Fallback –Ω–∞ in-memory –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, graceful degradation

---

## üìù –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º

- [ ] –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É `feature/celery-scraper-optimization`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- [ ] –°–æ–∑–¥–∞—Ç—å backup –ë–î
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `docs/REFACTORING/2025-11-10_refactoring_master_plan.md` - –æ–±—â–∏–π –ø–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- `docs/DOCKER_LOGS_ANALYSIS.md` - –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º
- `docs/ASYNC_BUTTONS_FIX.md` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ async –ø—Ä–æ–±–ª–µ–º
- `backend/app/services/crawl_schedule_service.py` - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-19  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** Development Team

