# Phase 2 ‚Äî News Domain Refactor Plan

–î–∞—Ç–∞: 2025-11-10  
–ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª: GPT-5 Codex

---

## 1. –¶–µ–ª—å
–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ç–µ–∫—É—â—É—é –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤–æ—Å—Ç—è–º–∏ (API `/api/v1/news/*`, —Å–µ—Ä–≤–∏—Å—ã, Celery –∑–∞–¥–∞—á–∏) –≤ –Ω–æ–≤—ã–π –¥–æ–º–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å `app/domains/news`, –≤—ã–¥–µ–ª–∏—Ç—å —á–µ—Ç–∫–∏–µ —Å–ª–æ–∏ (facade ‚Üí service ‚Üí repository), –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø–æ—á–≤—É –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.

## 2. –¢–µ–∫—É—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `app/services/news_service.py` ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –≤—ã–±–æ—Ä–∫–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.
- `app/api/v1/endpoints/news.py` ‚Äî —Ä—É—á–∫–∏ API, –Ω–∞–ø—Ä—è–º—É—é –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–µ—Ä–≤–∏—Å.
- `app/tasks/scraping.py`, `app/scrapers/*` ‚Äî —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö.
- `app/models/news.py`, `app/models/company.py` ‚Äî –º–æ–¥–µ–ª–∏ –∏ enum‚Äô—ã.
- `app/services/nlp_service.py` ‚Äî post-processing (keywords/summary).

## 3. –¶–µ–ª–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
app/
  domains/
    news/
      facade.py        # –ü—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è API/–∞–¥–∞–ø—Ç–µ—Ä–æ–≤
      services/
        ingestion.py   # –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π, –≤–∞–ª–∏–¥–∞—Ü–∏—è
        querying.py    # –í—ã–±–æ—Ä–∫–∏, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
      repositories/
        news_repo.py   # SQLAlchemy queries (NewsItem)
        company_repo.py
      dtos.py          # Pydantic schemas/DTO –¥–ª—è –º–µ–∂—Å–ª–æ–π–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è
      cache.py         # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
      tasks.py         # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Celery (scraping)

  api/
    v1/
      endpoints/
        news.py        # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç facade –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–∏—Å—É
```

- **Facade** ‚Äî –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞ (—Å—Ü–µ–Ω–∞—Ä–∏–∏: `create_news`, `list_news`, `get_stats`).
- **Services** ‚Äî —á–∏—Å—Ç–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏/–≤–Ω–µ—à–Ω–∏–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.
- **Repositories** ‚Äî –≤—Å—è SQLAlchemy Core/ORM –ª–æ–≥–∏–∫–∞, —á—Ç–æ–±—ã API –Ω–µ —Ç—Ä–æ–≥–∞–ª `AsyncSession`.
- **Tasks** ‚Äî Celery/cron –∑–∞–¥–∞—á–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–µ –∂–µ —Å–µ—Ä–≤–∏—Å—ã (—á–µ—Ä–µ–∑ facade).

## 4. –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏
1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã** ‚Äî ‚úÖ 10 Nov 2025 (—Å–æ–∑–¥–∞–Ω—ã `app/domains/news/*`, —Ñ–∞—Å–∞–¥, query repository)
   - –°–æ–∑–¥–∞—Ç—å –ø–∞–∫–µ—Ç—ã `app/domains/news/services`, `repositories`, `dtos`.
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å facade (–Ω–∞–ø—Ä–∏–º–µ—Ä, `class NewsFacade`), –æ–±–µ—Å–ø–µ—á–∏—Ç—å DI —á–µ—Ä–µ–∑ `Depends`.
2. **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏** ‚Äî ‚úÖ  
   - ‚úÖ –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã —á—Ç–µ–Ω–∏—è (`fetch_by_url`, `list_news`, `count`, `aggregate_statistics`, `fetch_recent`, `category_statistics`).  
   - ‚úÖ –°–æ–∑–¥–∞–Ω `CompanyRepository` –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏).  
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã unit-—Ç–µ—Å—Ç—ã –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ (`tests/unit/domains/news/test_*_repository.py`).
3. **–°–µ—Ä–≤–∏—Å—ã**
   - ‚úÖ `QueryService` —Å–æ–∑–¥–∞–Ω, —Ñ–∞—Å–∞–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –¥–ª—è —á—Ç–µ–Ω–∏—è/—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫.
   - ‚úÖ `IngestionService` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (create/update/delete, –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ DTO –∏ company repository). –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ API –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ.
4. **Facade** ‚Äî ‚úÖ
   - –°–æ–∑–¥–∞–Ω `NewsFacade`, –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É—é—â–∏–π query/ingestion —Å–µ—Ä–≤–∏—Å—ã (NLP/–∫–µ—à –¥–æ–±–∞–≤–∏–º –ø—Ä–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏).
   - API –ø–æ–ª—É—á–∞–µ—Ç —Ñ–∞—Å–∞–¥ —á–µ—Ä–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `get_news_facade`.
5. **API —Å–ª–æ–π** ‚Äî ‚úÖ
   - `app/api/v1/endpoints/news.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `NewsFacade` (—á—Ç–µ–Ω–∏–µ, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, CRUD). –ó–∞–≥–ª—É—à–∫–∏ mark-read/favorite –æ—Å—Ç–∞—é—Ç—Å—è –¥–ª—è –±—É–¥—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã: `tests/integration/api/test_news_endpoints.py` (CRUD, —Ñ–∏–ª—å—Ç—Ä—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞).
6. **Scraping/NLP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** ‚Äî üîÑ TODO  
   - ‚úÖ –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω `app/tasks/scraping.py`: ingest —á–µ—Ä–µ–∑ `NewsFacade` –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö SQL.  
   - ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç (`tests/integration/tasks/test_scraping_task.py`) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç ingest –∏ —Å–≤—è–∑—å —Å –∫–æ–º–ø–∞–Ω–∏—è–º–∏.  
   - ‚úÖ –°–æ–∑–¥–∞–Ω –¥–æ–º–µ–Ω–Ω—ã–π –∞–¥–∞–ø—Ç–µ—Ä (`app/domains/news/tasks.py`), Celery-–∑–∞–¥–∞—á–∏ —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞—é—Ç pipeline —á–µ—Ä–µ–∑ —Ñ–∞—Å–∞–¥ –∏ –æ–±—â–∏–π session scope.  
   - ‚úÖ NLP –ø–∞–π–ø–ª–∞–π–Ω –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –Ω–∞ `AsyncSession`, Celery –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–æ–º–µ–Ω–Ω—ã–π –∞–¥–∞–ø—Ç–µ—Ä –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–æ—Å—Ç.  
   - ‚òê –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–∏ (—Å–º. —Ä–∞–∑–¥–µ–ª 8).
7. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç—ã**
   - –û–±–Ω–æ–≤–∏—Ç—å `docs/REFACTORING/backend/phase2_bounded_contexts.md` –ø–æ—Å–ª–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–Ω–æ—Å–∞.
   - –î–æ–ø–æ–ª–Ω–∏—Ç—å `phase2_raw_sql_inventory.md`, –µ—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –Ω–æ–≤—ã–µ SQL –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.

## 5. –í–ª–∏—è–Ω–∏–µ
- **API**: –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–æ–≤ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–æ–∂–∏–¥–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤).
- **–¢–µ—Å—Ç—ã**: –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å unit/–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π.
- **Celery**: —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∑–∞–¥–∞—á–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã (–ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä `app/tasks/scraping.py`).

## 6. –†–∏—Å–∫–∏ –∏ –º–µ—Ä—ã
- **–†–µ–≥—Ä–µ—Å—Å—ã –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏** ‚Äî –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å baseline (—É–∂–µ —Å–Ω—è—Ç –≤ Phase 0), –¥–æ–±–∞–≤–∏—Ç—å regression tests.
- **–°–ª–æ–∂–Ω–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏** ‚Äî –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ—ç—Ç–∞–ø–Ω–æ (—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ ‚Üí —Å–µ—Ä–≤–∏—Å—ã ‚Üí facade ‚Üí API).
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** ‚Äî —Å–ª–µ–¥–∏—Ç—å –∑–∞ import cycles; –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã/–ø—Ä–æ—Ç–æ–∫–æ–ª—ã.

## 7. –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
- –£—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–ª–∞–Ω –Ω–∞ —Å–æ–∑–≤–æ–Ω–µ Backend-–∫–æ–º–∞–Ω–¥—ã.
- –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á–∏:
  - `B-201-1` ‚Äî scaffolding –ø–∞–∫–µ—Ç–æ–≤ –∏ facade.
  - `B-201-2` ‚Äî –ø–µ—Ä–µ–Ω–æ—Å querying logic –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
  - `B-201-3` ‚Äî –ø–µ—Ä–µ–Ω–æ—Å ingestion logic.
  - `B-201-4` ‚Äî —Ä–µ—Ñ–∞–∫—Ç–æ—Ä API + —Ç–µ—Å—Ç—ã.
  - `B-201-5` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á scraping/NLP.
- –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏ –∑–∞–∫—Ä—ã—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —á–µ–∫-–ª–∏—Å—Ç—ã.

## 8. –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ NLP/ingestion –ø–∞–π–ø–ª–∞–π–Ω–∞
- **–¶–µ–ª—å:** –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ `app/services/nlp_service.py` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ Celery-–∑–∞–¥–∞—á–∏ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∞—Å–∞–¥–∞ –∏ –Ω–æ–≤—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –±–µ–∑ –ø—Ä—è–º—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ `AsyncSessionLocal`.
- **–®–∞–≥–∏:**
- [x] –°–æ–∑–¥–∞—Ç—å –∞–¥–∞–ø—Ç–µ—Ä –≤ `app/domains/news/tasks.py`, –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É—é—â–∏–π –≤—ã–∑–æ–≤—ã NLP-–ø–∞–π–ø–ª–∞–π–Ω–∞ –∏ Celery-—Ç–∞—Å–∫–æ–≤.
- [x] –í–Ω–µ–¥—Ä–∏—Ç—å –∞–¥–∞–ø—Ç–µ—Ä –≤ `app/tasks/nlp.py`; pipeline –≤—ã–∑—ã–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ –¥–æ–º–µ–Ω–Ω—ã–π —Å–ª–æ–π.
- [x] –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `NewsNLPPipeline` –Ω–∞ —Ä–∞–±–æ—Ç—É —Å `AsyncSession`, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–º –∏–∑–≤–Ω–µ (–æ—Ç–∫—Ä—ã–≤–∞—è –ø—É—Ç—å –∫ –∏–Ω—ä–µ–∫—Ü–∏–∏ —Ñ–∏–∫—Å—Ç—É—Ä –≤ —Ç–µ—Å—Ç–∞—Ö).
- [x] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (eager Celery) –¥–ª—è `classify_news/summarize_news/extract_keywords`, –º–æ–∫–∏—Ä—É—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.
- [x] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏ README (—Å–µ–∫—Ü–∏–∏ ‚Äú–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ‚Äù –∏ Phase 2 backlog) –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é.
- **–ü—Ä–æ–≤–µ—Ä–∫–∏:** –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ (–≤–ª–∏—è–Ω–∏–µ –Ω–∞ priority/topic), —É–±–µ–¥–∏—Ç—å—Å—è –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–µ–≥—Ä–µ—Å—Å–∏–π –Ω–∞ baseline –¥–∞—Ç–∞—Å–µ—Ç–µ, –¥–æ–±–∞–≤–∏—Ç—å snapshot —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ `docs/REFACTORING/tests/phase2_news_testing_plan.md`.

---

**–°—Ç–∞—Ç—É—Å:** –ø–ª–∞–Ω —É—Ç–≤–µ—Ä–∂–¥—ë–Ω (–∂–¥—ë—Ç –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –∑–∞–¥–∞—á–∏).  
**–ü–æ–¥–ø–∏—Å—å:** GPT-5 Codex ‚Äî 10 Nov 2025

