## Итерация 2 — Сбор тарифов, функциональности и обнаружение изменений

### Цель
- Научиться фиксировать ценовые и функциональные изменения конкурентов, хранить историю и предоставлять её в аналитике.

### Основные задачи
- **Парсеры тарифов/функций**: добавить модуль для обработки страниц с тарифами и описанием функциональности; нормализовать данные (`plan`, `price`, `currency`, `billing_cycle`, `feature_group`, `value`), учитывать различные форматы (таблицы, списки, карточки).
- **Качество данных**: валидация валют и единиц измерения, автокоррекция числовых значений, хранение сырых снапшотов для трассировки.
- **Модуль сравнения**: внедрить change detection (хеширование, diff значимых полей, фильтрация шумов), логировать статус обработки (успех/ошибка/пропуск), поддержать повторное вычисление diff.
- **Хранилище событий**: создать таблицу/коллекцию `competitor_change_events` с атрибутами (`source_type`, `change_summary`, `changed_fields`, `detected_at`, ссылка на снапшот, статус обработки уведомлений).
- **API**: расширить существующие ручки либо создать новую для истории изменений, докуменировать схему `change_event`.
- **Frontend**: на `CompetitorAnalysisPage` добавить секцию «Последние изменения» с типом источника, кратким diff, статусом обработки, ссылками на снапшоты.
- **Документация**: обновить `README` (описание модуля изменений, структура данных, файловая ответственность), подготовить гайд для аналитиков по интерпретации событий.
- **Тестирование**: unit-тесты для новых парсеров и diff-логики; интеграционные тесты change detection; e2e сценарий «изменение → событие → отображение на странице».

### Критерии готовности
- Парсеры стабильно извлекают тарифы и функциональность на тестовых и реальных примерах.
- При изменении данных создаётся корректное событие с diff и ссылкой на исходный контент.
- UI отображает историю изменений и статус их обработки.
- Набор автотестов покрывает парсеры, diff и эндпоинты истории.
- Документация актуальна и содержит инструкции по работе с событиями изменений.


### Статус на 2025‑11‑09
- ✅ Добавлены таблицы `competitor_pricing_snapshots` и `competitor_change_events` (Alembic миграция `1b2c3d4e5f67_add_competitor_change_events.py`) с хранением хеша данных, ссылок на сырые HTML и статусами обработок/уведомлений.
- ✅ Модуль `backend/app/parsers/pricing.py` покрывает карточки, таблицы и списки тарифов; валидирует валюты и биллинг, нормализует фичи.
- ✅ `backend/app/services/competitor_change_service.py` сравнивает снапшоты, фильтрует шум, строит diff, сохраняет события и умеет пересчитывать diff по ручному запросу.
- ✅ REST-ручки `/api/v1/competitors/changes/{company_id}` и `/api/v1/competitors/changes/{event_id}/recompute` выдают историю изменений для фронтенда и аналитиков.
- ✅ Фронтенд `CompetitorAnalysisPage` отображает секцию **Latest Changes** с кратким diff, статусом обработки, ссылками на снапшоты и кнопкой пересчёта.
- ✅ Добавлены unit-тесты для парсера и diff (`backend/tests/test_pricing_parser.py`), обновлена документация и README с описанием новых модулей.
