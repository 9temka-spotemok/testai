# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –Ω–∞ Railway

## ‚ö†Ô∏è –í–∞–∂–Ω–æ: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Railway Dashboard

–ö–æ–º–∞–Ω–¥–∞ `railway run` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Railway –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å–µ—Ç—å. **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Railway Dashboard** –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π.

## üöÄ –†–µ—à–µ–Ω–∏–µ: –ß–µ—Ä–µ–∑ Shell –≤ Dashboard (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Railway Dashboard

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://railway.app
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–≤–∏—Å **web** (–∏–ª–∏ **backend**, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)

### –®–∞–≥ 2: –û—Ç–∫—Ä–æ–π—Ç–µ Shell

**–í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Deployments**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Deployments** ‚Üí **Latest deployment**
2. –ù–∞–∂–º–∏—Ç–µ **Shell** (–∏–ª–∏ **View Logs** ‚Üí **Shell**)

**–í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å**
1. –í –º–µ–Ω—é —Å–µ—Ä–≤–∏—Å–∞ –≤—ã–±–µ—Ä–∏—Ç–µ **Shell** –∏–ª–∏ **Connect**

### –®–∞–≥ 3: –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏

–í –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é backend
cd backend

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –º–∏–≥—Ä–∞—Ü–∏–π
python -m alembic current

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏
python -m alembic upgrade head

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
python -m alembic current

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
python scripts/check_migrations.py
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `alembic upgrade head` –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π (–µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –±—ã–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —Ä–∞–Ω–µ–µ)
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–∂–µ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ (–µ—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã)

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Ç–∞–±–ª–∏—Ü–µ `crawl_schedules` –≤ –ª–æ–≥–∞—Ö beat —Å–µ—Ä–≤–∏—Å–∞ –¥–æ–ª–∂–Ω–æ –∏—Å—á–µ–∑–Ω—É—Ç—å.

## –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ SQL

–ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∏–∑-–∑–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `notification_deliveries` –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ SQL:

1. –û—Ç–∫—Ä–æ–π—Ç–µ Railway Dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç ‚Üí —Å–µ—Ä–≤–∏—Å **web**
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Data** ‚Üí **PostgreSQL** ‚Üí **Query**
4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ —Ñ–∞–π–ª–∞ `create_notification_deliveries.sql`

–ò–ª–∏ —á–µ—Ä–µ–∑ Railway CLI:
```powershell
railway connect postgres
# –ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∫–æ–º–∞–Ω–¥—ã –∏–∑ create_notification_deliveries.sql
```

## –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ "Can't locate revision"

–ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É `Can't locate revision identified by '0001_initial_schema'`, —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–∞–Ω–∞ —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏. –í—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
cd backend
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –≤ –±–∞–∑–µ
python -c "from sqlalchemy import create_engine, text; import os; engine = create_engine(os.environ['DATABASE_URL'].replace('+asyncpg', '')); with engine.connect() as conn: print(conn.execute(text('SELECT version_num FROM alembic_version')).scalar())"

# –ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è '0001_initial_schema', –æ–±–Ω–æ–≤–∏—Ç–µ –µ—ë –Ω–∞ 'initial_schema'
python -c "from sqlalchemy import create_engine, text; import os; engine = create_engine(os.environ['DATABASE_URL'].replace('+asyncpg', '')); with engine.connect() as conn: conn.execute(text(\"UPDATE alembic_version SET version_num = 'initial_schema' WHERE version_num = '0001_initial_schema'\")); conn.commit()"

# –ó–∞—Ç–µ–º –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
python -m alembic upgrade head
```

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ Railway CLI (–µ—Å–ª–∏ shell —Ä–∞–±–æ—Ç–∞–µ—Ç)

```powershell
railway shell
cd backend
python -m alembic upgrade head
exit
```

### –°–ø–æ—Å–æ–± 3: –°–æ–∑–¥–∞—Ç—å –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π deployment

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω–∏—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:

1. –í Railway Dashboard —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å
2. –£–∫–∞–∂–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∑–∞–ø—É—Å–∫–∞: `cd backend && python -m alembic upgrade head`
3. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π —É–¥–∞–ª–∏—Ç–µ —Å–µ—Ä–≤–∏—Å

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
python -m alembic current

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–∞–±–ª–∏—Ü
python scripts/check_migrations.py
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã:
- ‚úÖ `crawl_schedules` ‚Äî –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π –æ–±—Ö–æ–¥–æ–≤
- ‚úÖ `source_profiles` ‚Äî –ø—Ä–æ—Ñ–∏–ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ `crawl_runs` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∑–∞–ø—É—Å–∫–æ–≤ –æ–±—Ö–æ–¥–æ–≤
- ‚úÖ `notification_channels` ‚Äî –∫–∞–Ω–∞–ª—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ `notification_events` ‚Äî —Å–æ–±—ã—Ç–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ `notification_subscriptions` ‚Äî –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ `notification_deliveries` ‚Äî –¥–æ—Å—Ç–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ SQL (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±)

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ SQL:

1. –í Railway Dashboard –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç ‚Üí **PostgreSQL** —Å–µ—Ä–≤–∏—Å
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Data** ‚Üí **Query**
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü—ã crawl_schedules
SELECT EXISTS (
    SELECT 1 
    FROM information_schema.tables 
    WHERE table_schema = 'public' 
    AND table_name = 'crawl_schedules'
);

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –º–∏–≥—Ä–∞—Ü–∏–π
SELECT version_num FROM alembic_version;
```

## üìù –í–∞–∂–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏

- **`1f2a3b4c5d6e_add_crawl_and_notification_channels.py`** ‚Äî —Å–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –æ–±—Ö–æ–¥–æ–≤ (`crawl_schedules`, `source_profiles`, `crawl_runs`) –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (`notification_channels`, `notification_events`, `notification_subscriptions`, `notification_deliveries`)
- **`f7a8b9c0d1e2_add_news_topic_sentiment_snapshot.py`** ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—è `topic`, `sentiment` –∏ `raw_snapshot_url` –≤ —Ç–∞–±–ª–∏—Ü—É `news_items`

